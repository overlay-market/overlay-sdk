import { describe, it, expect } from 'vitest'
import { OverlaySDKShiva } from '@src/shiva/shiva.js'

describe('decodeMinOutFromSwapPayload', () => {
  it('extracts minReturnAmount from 1inch swap payload', () => {
    const payload =
      '0x07ed23790000000000000000000000008c864d0c8e476bf9eb9d620c10e1296fb0e2f9400000000000000000000000001A0eF183D548405705bb9B00E8b4ef3524AE090E00000000000000000000000018b702fD1b63dccbc58D30379B9365679b32618d0000000000000000000000008c864d0c8e476bf9eb9d620c10e1296fb0e2f9400000000000000000000000009fB7D92526Fc13bB3c0603d39E55e5C371c26Ce60000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000009deaa694d67ac90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000e90000000000000000000000000000000000000000000000cb00006800001a0020d6bdbf781A0eF183D548405705bb9B00E8b4ef3524AE090E00a0744c8c091A0eF183D548405705bb9B00E8b4ef3524AE090E90cbe4bdd538d6e9b379bff5fe72c3d67a521de5000000000000000000000000000000000000000000000000000aa87bee53800002a00000000000000000000000000000000000000000000000000000000000000001ee63c1e581c3b423339da62f48f75a1ac9a528c0c4a2e5783d1A0eF183D548405705bb9B00E8b4ef3524AE090E111111125421ca6dc452d289314280a0f8842a650000000000000000000000000000000000000000000000a13324ca' as const

    const decodeMinOut = (OverlaySDKShiva.prototype as any)
      .decodeMinOutFromSwapPayload as (p: `0x${string}`) => bigint | undefined

    const minOut = decodeMinOut(payload)

    expect(minOut).toBe(44449572526127817n)
  })
})
